name: edl-dashboard-infra
on: 
 workflow_dispatch:
env: 
  willDeployToLowerEnvironments: 'true'
  project_name: edl-dashboard-infra
 
jobs:
  Build:
   strategy:
       matrix:
        node-version: ['8.10.0']
        envNamesAndAccounts: [ {env: devl, account: CIS_DEVL_AWS_ACCT}, {env: prod,account: CIS_PROD_AWS_ACCT }]
   runs-on: ubuntu-latest
   steps:
   - uses: actions/checkout@v1
   - name: CreateflagforwillDeployToLowerEnvironments 
     id: create_willDeployToLowerEnvironments
     run: |
            echo "::set-output name=willDeployToLowerEnvironments::$willDeployToLowerEnvironments"

   - name: PushToImage
     run: |
        echo "aws ecr get-login --no-include-email --region us-east-1"
        echo "docker build -t edl-dashboard-repo './infrastructure/docker/$environmentName'"
        echo "docker tag edl-dashboard-repo:latest '${currentAccountNumber}.dkr.ecr.us-east-1.amazonaws.com/edl-dashboard-repo:latest'"
        echo "docker push '${currentAccountNumber}.dkr.ecr.us-east-1.amazonaws.com/edl-dashboard-repo:latest'"
        echo "Image push complete"
   - name: Setup Node.js ${{ matrix.node-version }}
     uses: actions/setup-node@v2
     with: 
       node-version: ${{ matrix.node-version }}
       env:  ${{ matrix.envNamesAndAccounts.env }} source.env
   - name: DeploymentSetup_node_install
     run: |
       echo "EDL/ActionTemplates/.github/actions/CommonSteps/nodeInstall@H1KII3K-patch-2"
   - name: Run-me if willDeployToLowerEnvironments is true
     if: ${{ steps.create_willDeployToLowerEnvironments.outputs.willDeployToLowerEnvironments== 'true' }}
     run: |
       echo "pass groovy"
       export url
       url=echo "git config remote.origin"
       export willDeployToProd
       willDeployToProd = "Branch_name == master && url == "git@github.deere.com:EDL/${project_name}.git" || url == "https://github.deere.com/EDL/${project_name}.git"
      
      
   


            
            
            
    
      
  
      
