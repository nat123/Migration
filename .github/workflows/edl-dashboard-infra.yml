name: edl-dashboard-infra
on: 
 workflow_dispatch:
jobs:
  pushToImage:
    runs-on: ubuntu-latest
    steps:
     - uses: actions/checkout@v1
     - run: |
        "\$(aws ecr get-login --no-include-email --region us-east-1)"
        "docker build -t edl-dashboard-repo './infrastructure/docker/$environmentName'"
        "docker tag edl-dashboard-repo:latest '${currentAccountNumber}.dkr.ecr.us-east-1.amazonaws.com/edl-dashboard-repo:latest'"
        "docker push '${currentAccountNumber}.dkr.ecr.us-east-1.amazonaws.com/edl-dashboard-repo:latest'"
        "Image push complete"
  Nodejs:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: ['8.10.0']
        env: ['devl', 'prod']
        account: ['env.CIS_DEVL_AWS_ACCT','env.CIS_PROD_AWS_ACCT']
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
  DeploymentSetup:
     name: DeploymentSetup
     runs-on: ubuntu-latest
     steps: 
     - uses: actions/checkout@v2
     - name: Read environment.yml
       id: package
       uses: juliangruber/read-file-action@v1
       with:
        path: ./environment.yml
     - name: Echo package.json
       run: echo "${{ steps.package.outputs.content }}"
  Package:
     name: Run-me if FLAG is true
     if: ${{ willDeployToLowerEnvironments }} == "true"
     runs-on: ubuntu-latest
     steps: 
     - uses: actions/checkout@v2
     - run: |
           if [[ $willDeployToLowerEnvironments == "true" ]]; 
           then
           echo "url = ./git config remote.origin.url "
           echo $url
           echo "willDeployToProd = ${{env.BRANCH_NAME}} = "master" && $url=git@github.deere.com:EDL/${{env.project_name}}.git ||
               $url=https://github.deere.com/EDL/${{env.project_name}}.git"
           echo $willDeployToProd
           fi
          
        
        
        
      
        
        
